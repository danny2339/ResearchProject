@using PagedList.Core.Mvc
@model PagedList.Core.IPagedList<ResearchProject.Models.Product>
@{ ViewData["Title"] = "Shop - " + ViewBag.CurrentPage;
                Layout = "~/Views/Shared/_Layout.cshtml";
                int PageCurrent = ViewBag.CurrentPage;
                int PageNext = PageCurrent + 1;
                List<Product> saleoff = ViewBag.Saleoff;
                List<Product> latest = ViewBag.Latest;
                List<Product> latest1 = ViewBag.Latest1;
                List<Category> lscat = ViewBag.lscat;
                int total = ViewBag.total;
}


<!-- Hero Section Begin -->
<section class="hero hero-normal">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="hero__categories">
                    <div class="hero__categories__all">
                        <i class="fa fa-bars"></i>
                        <span>Category</span>
                    </div>
                    <ul>
                        @if (lscat != null && lscat.Count() > 0)
                        {
                            foreach (var item in lscat)
                            {
                                string urlcatt = $"/{item.Alias}";
            <li><a href="@urlcatt">@item.CatName</a></li>}
                        }
                    </ul>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="hero__search">
                    <div class="hero__search__form">
                        <input id="keyword" name="keyword" type="text" class="form-control" placeholder="Search" />
                        <button type="submit" class="site-btn">SEARCH</button>
                    </div>
                    <div class="hero__search__phone">
                        <div class="hero__search__phone__icon">
                            <i class="fa fa-phone"></i>
                        </div>
                        <div class="hero__search__phone__text">
                            <h5><a href="tel://84785718899">+84.785.718.899</a></h5>
                            <span>support 24/7 time</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Hero Section End -->
<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-section set-bg" data-setbg="assets/img/breadcrumb.jpg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12 text-center">
                <div class="breadcrumb__text">
                    <h2>Organi Shop</h2>
                    <div class="breadcrumb__option">
                        <a href="/">Home</a>
                        <span>Product List</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Breadcrumb Section End -->
<!-- Product Section Begin -->
<section class="product spad">
    <div class="container">
        <div class="row">
            <div class="col-lg-3 col-md-5">
                <div class="sidebar">
                    <div class="sidebar__item">
                        <h4>Category</h4>
                        @if (lscat != null && lscat.Count() > 0)
                        {
                            foreach (var item in lscat)
                            {
                                string urlcat = $"/{item.Alias}";
            <ul>
                <li><a href="@urlcat">@item.CatName</a></li>
            </ul>}
                        }
                    </div>
                   
                    <div class="sidebar__item">
                        <div class="latest-product__text">
                            <h4>Latest Products</h4>
                            <div class="latest-product__slider owl-carousel">
                                <div class="latest-prdouct__slider__item">
                                    @if (latest1 != null && latest1.Count() > 0)
                                    {
                                        foreach (var item in latest1)
                                        {
                                            string _url = $"/{item.Alias}-{item.ProductId}.html";
                        <a href="@_url" class="latest-product__item">
                            <div class="latest-product__item__pic">
                                <img src="~/images/products/@item.Thumb" alt="@item.Title">
                            </div>
                            <div class="latest-product__item__text">
                                <h6>@item.ProductName</h6>
                                <span>@item.Price$</span>
                            </div>
                        </a>}
                }
                                </div>
                                <div class="latest-prdouct__slider__item">
                                    @if (latest != null && latest.Count() > 0)
                                    {
                                        foreach (var item in latest)
                                        {
                                            string _url = $"/{item.Alias}-{item.ProductId}.html";
                        <a href="@_url" class="latest-product__item">
                            <div class="latest-product__item__pic">
                                <img src="~/images/products/@item.Thumb" alt="@item.Title">
                            </div>
                            <div class="latest-product__item__text">
                                <h6>@item.ProductName</h6>
                                <span>@item.Price$</span>
                            </div>
                        </a>}
                }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-9 col-md-7">
                <div class="product__discount">
                    <div class="section-title product__discount__title">
                        <h2>Sale Off</h2>
                    </div>
                    <div class="row">
                        <div class="product__discount__slider owl-carousel">
                            @if (saleoff != null && saleoff.Count() > 0)
                            {
                                foreach (var item in saleoff)
                                {
                                    string _url = $"/{item.Alias}-{item.ProductId}.html";
                <div class="col-lg-4">
                    <div class="product__discount__item">
                        <div class="product__discount__item__pic set-bg"
                             data-setbg="images/products/@item.Thumb">
                            <ul class="product__item__pic__hover">
                                <li><a href="javascript:void(0)" class="add" data-mhh="@item.ProductId"><i class="fa fa-shopping-cart"></i></a></li>
                            </ul>
                        </div>
                        <div class="product__discount__item__text">

                            <h5><a href="@_url">@item.ProductName</a></h5>
                            <div class="product__item__price">@item.Discount$ <span>@item.Price</span></div>
                        </div>
                    </div>
                </div>}
                            }
                        </div>
                    </div>
                </div>
                <div class="filter__item">
                    <div class="row">
                        <div class="col-lg-4 col-md-5">
                            <div class="filter__sort">
                                
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4">
                            <div class="filter__found">
                                <h6><span>@total</span> Products found</h6>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-3">
                            <div class="filter__option">
                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="records_table">
                    @if (Model != null && Model.Count() > 0)
                    {
                        foreach (var item in Model)
                        {
                            string url = $"/{item.Alias}-{item.ProductId}.html";
        <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="product__item">
                <div class="product__item__pic set-bg" data-setbg="images/products/@item.Thumb">
                    <ul class="product__item__pic__hover">
                        <li><a href="javascript:void(0)" class="add" data-mhh="@item.ProductId"><i class="fa fa-shopping-cart"></i></a></li>
                    </ul>
                </div>
                <div class="product__item__text">
                    <h6><a href="@url">@item.ProductName</a></h6>
                    <h5>@item.Price$</h5>
                </div>
            </div>
        </div>}
                    }
                </div>
                <div aria-label="Page Navigation">
                    <ul class="pagination justify-content-center">
                        <pager class="pager-container" options="@PagedListRenderOptions.Bootstrap4PageNumbersPlusPrevAndNext" list="@Model" asp-area="" asp-controller="Product" asp-action="Index" />
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Product Section End -->
@section Scripts{
    <script>
    $(document).ready(function () {
        $(function () {
            $(".add").click(function () {
                var productid = $(this).attr("data-mhh");
                var amount =1;
                $.ajax({
                    url: '/api/cart/add',
                    type: "POST",
                    dataType: "JSON",
                    data: {
                        productId: productid,
                        amount: amount
                    },
                    success: function (response) {
                        loadHeaderCart();
                        location.reload();
                    },
                    error: function (error) {
                        alert("There was an error posting the data to the server: " + error.responseText);
                    }
                });
            });
        });
        $("#keyword").keyup(function () {
            var strkeyword = $("#keyword").val();
            $.ajax({
                url: '/Product/FindProduct/',
                datatype: "json",
                type: "POST",
                data: { keyword: strkeyword },
                async: true,
                success: function (results) {
                    $("#records_table").html("");
                    $("#records_table").html(results);
                },
                error: function (xhr) {
                    alert('error');
                }
            });
        });

        function loadHeaderCart() {
            $('#numbercart').load("/AjaxContent/NumberCart");
        }
        $(".icon_close").click(function () {
            var productid = $(this).attr("data-mhh");
            $.ajax({
                url: "api/cart/remove",
                type: "POST",
                dataType: "JSON",
                data: {
                    productId: productid
                },
                success: function (result) {
                    if (result.success) {
                        loadHeaderCart();
                        window.location = 'cart.html';
                    }
                },
                error: function (rs) {
                    alert("Remove cart error!");
                }
            });
        });

        $(".cartItem").click(function () {
            var productid = $(this).attr("data-mhh");
            var amounts = parseInt($(this).val());
            $.ajax({
                url: "api/cart/update",
                type: "POST",
                dataType: "JSON",
                data: {
                    productID: productid,
                    amount: amounts
                },
                success: function (result) {
                    if (result.success) {
                        loadHeaderCart();
                        window.location = 'cart.html';
                    }
                },
                error: function (rs) {
                    alert("Update cart error!");
                }
            });
        });
    });
    </script>
}